<html>
  <head>
    <script>
      function sendRow(id) {
        if (window.AndroidInterface) {
          window.AndroidInterface.sendRowId(id);
        }
      }

      function receiveTable(tableContent) {
        document.getElementById("infoListContainer").innerHTML = tableContent;
      }

      function receiveReport(jsonData) {
        //Kho ruou summary report
        try {
          const list = JSON.parse(jsonData);
          let lvnSlIn = 0;
          let lvnStIn = 0;
          let lvnSlOut = 0;
          let lvnStOut = 0;
          list.forEach(function(entity) {
            if (entity.inOut === "Out") {
              lvnSlOut += Number(entity.quantity);
              lvnStOut += Number(entity.quantity) * Number(entity.price);
            } else if (entity.inOut === "In") {
              lvnSlIn += Number(entity.quantity);
              lvnStIn += Number(entity.quantity) * Number(entity.price);
            }
          });
          lvnStOut *= 1000;
          lvnStIn *= 1000;
          let lvsSlIn = lvnSlIn.toLocaleString();
          let lvsStIn = lvnStIn.toLocaleString();
          let lvsSlOut = lvnSlOut.toLocaleString();
          let lvsStOut = lvnStOut.toLocaleString();
		  ///-------------
		  const origList = JSON.parse(jsonData);
          let selectedList = [];
          let execFlag = true;
		  let htmlRows = `
			
			<table>
				<tr>
					<th>Tên hàng</th>
					<th>Loại đơn</th>
					<th>Số lượng</th>
					<th>Số tiền</th>
				</tr>
				`;
          while (execFlag) {
            execFlag = false;
            let catalogName = "";
            let ordersType = "";
            let sLuong = 0;
            let sTien = 0;
            origList.forEach(function(entity) {
              const isSelected = selectedList.some(item => item.id === entity.id);
              if (!isSelected) {
                if (execFlag === false) {
                  catalogName = entity.catalogName;
                  ordersType = entity.inOut;
                  execFlag = true;
                }
                if (catalogName === entity.catalogName && ordersType === entity.inOut) {
                  sLuong += Number(entity.quantity);
                  sTien += Number(entity.quantity) * Number(entity.price);
					selectedList.push(entity);
                }
              }
            });
			let trList = sumReport(jsonData);
            htmlRows = `
			<table>
			<tr>
					<th>Tên hàng</th>
					<th>Loại đơn</th>
					<th>Số lượng</th>
					<th>Số tiền</th>
				</tr>
			${trList}
		  `;
          }
		  htmlRows +=`
		  </table>
		  `;
		  ///----------------
		  
          document.getElementById("reportContainer").innerHTML = htmlRows;
        } catch (e) {
          console.error("Lỗi: ", e);
        }
      }

      function sumReport(jsonData) {
        //Tong hop so lieu
        let trList = "";
        try {
          const origList = JSON.parse(jsonData);
          let selectedList = [];
          let execFlag = true;
          while (execFlag) {
            execFlag = false;
            let catalogName = "";
            let ordersType = "";
            let sLuong = 0;
            let sTien = 0;
            origList.forEach(function(entity) {
              const isSelected = selectedList.some(item => item.id === entity.id);
              if (!isSelected) {
                if (execFlag === false) {
                  catalogName = entity.catalogName;
                  ordersType = entity.inOut;
                  execFlag = true;
                }
                if (catalogName === entity.catalogName && ordersType === entity.inOut) {
                  sLuong += Number(entity.quantity);
                  sTien += Number(entity.quantity) * Number(entity.price);
				  selectedList.push(entity);
                }
              }
            });
            trList += `
			
			<tr>
				<td> ${catalogName}</td>
				<td> ${ordersType}</td>
				<td> ${sLuong}</td>
				<td> ${sTien}</td>
			</tr>
		  `;
          }
        } catch (e) {
          console.error("Lỗi: ", e);
        }
        return trList;
      }
    </script>
    <style>
      table,
      tr,
      th,
      td {
        border: 1px solid black;
        border-collapse: collapse;
        font-size: 11pt;
      }

      tr:nth-child(even) {
        background-color: #FFFFDA;
      }

      tr:nth-child(odd) {
        background-color: #EBFDEF;
      }

      tr:active {
        border: 2px solid #AAAAAA;
      }

      tr:hover {
        border: 1px solid black;
      }

      td:nth-child(even) {
        background-color: rgba(216, 218, 253, 0.5);
      }

      .title {
        background-color: #888888;
        border: 1px solid black;
      }

      .sticky-header {
        position: sticky;
        top: 0;
        z-index: 10;
        background-color: #888888;
      }

      .align-left {
        text-align: left;
      }

      .align-right {
        text-align: right;
      }

      .align-center {
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="reportContainer"></div>
    <div id="infoListContainer"></div>
  </body>
</html>
